<h2>Examples</h2><table class="table table-bordered table-light mt-2"><thead><tr> <th scope="col">Name</th><th scope="col">Description</th></tr></thead><tbody class="bg-white"><tr><td><a href="https://attack.mitre.org/groups/G0080">Cobalt Group</a></td><td><p><a href="https://attack.mitre.org/groups/G0080">Cobalt Group</a> has used the command <code>cmstp.exe /s /ns C:\Users\ADMINI~W\AppData\Local\Temp\XKNqbpzl.txt</code> to bypass AppLocker and launch a malicious script.<span onclick="scrollToRef(&#39;scite-7&#39;)" id="scite-ref-7-a" class="scite-citeref-number" data-reference="Talos Cobalt Group July 2018"><sup><a href="https://blog.talosintelligence.com/2018/07/multiple-cobalt-personality-disorder.html" target="_blank" data-hasqtip="6" aria-describedby="qtip-6">[7]</a></sup></span></p></td></tr><tr><td><a href="https://attack.mitre.org/groups/G0069">MuddyWater</a></td><td><p><a href="https://attack.mitre.org/groups/G0069">MuddyWater</a> has used CMSTP.exe and a malicious INF to execute its <a href="https://attack.mitre.org/software/S0223">POWERSTATS</a> payload.<span onclick="scrollToRef(&#39;scite-8&#39;)" id="scite-ref-8-a" class="scite-citeref-number" data-reference="FireEye MuddyWater Mar 2018"><sup><a href="https://www.fireeye.com/blog/threat-research/2018/03/iranian-threat-group-updates-ttps-in-spear-phishing-campaign.html" target="_blank" data-hasqtip="7" aria-describedby="qtip-7">[8]</a></sup></span></p></td>
<h2>Mitigation</h2>
            <p>CMSTP.exe may not be necessary within a given environment (unless using it for VPN connection installation). Consider using application whitelisting configured to block execution of CMSTP.exe if it is not required for a given system or network to prevent potential misuse by adversaries. <span id="scite-ref-3-a" class="scite-citeref-number" data-reference="MSitPros CMSTP Aug 2017"><sup><a href="https://msitpros.com/?p=3960" target="_blank" data-hasqtip="2" aria-describedby="qtip-2">[3]</a></sup></span></p>
            <h2 class="pt-3" id="detection">Detection</h2>
            <p>Use process monitoring to detect and analyze the execution and arguments of CMSTP.exe. Compare recent invocations of CMSTP.exe with prior history of known good arguments and loaded files to determine anomalous and potentially adversarial activity.</p><p>Sysmon events can also be used to identify potential abuses of CMSTP.exe. Detection strategy may depend on the specific adversary procedure, but potential rules include: <span id="scite-ref-6-a" class="scite-citeref-number" data-reference="Endurant CMSTP July 2018"><sup><a href="http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/" target="_blank" data-hasqtip="5" aria-describedby="qtip-5">[6]</a></sup></span></p><ul><li>To detect loading and execution of local/remote payloads - Event 1 (Process creation) where ParentImage contains CMSTP.exe and/or Event 3 (Network connection) where Image contains CMSTP.exe and DestinationIP is external.</li><li>To detect <a href="https://attack.mitre.org/techniques/T1088">Bypass User Account Control</a> via an auto-elevated COM interface - Event 10 (ProcessAccess) where CallTrace contains CMLUA.dll and/or Event 12 or 13 (RegistryEvent) where TargetObject contains CMMGR32.exe. Also monitor for events, such as the creation of processes (Sysmon Event 1), that involve auto-elevated CMSTP COM interfaces such as CMSTPLUA (3E5FC7F9-9A51-4367-9063-A120244FBEC7) and CMLUAUTIL (3E000D72-A845-4CD9-BD83-80C07C3B881F).
<h2>References</h2><div class="row"><div class="col"><ol><li><span id="scite-1" class="scite-citation"><span class="scite-citation-text"><a rel="nofollow" class="external text" name="scite-1" href="https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc786431(v=ws.10)" target="_blank">Microsoft. (2009, October 8). How Connection Manager Works. Retrieved April 11, 2018.</a></span></span></li><li><span id="scite-2" class="scite-citation"><span class="scite-citation-text"><a rel="nofollow" class="external text" name="scite-2" href="https://twitter.com/ItsReallyNick/status/958789644165894146" target="_blank">Carr, N. (2018, January 31). Here is some early bad cmstp.exe... Retrieved April 11, 2018.</a></span></span></li><li><span id="scite-3" class="scite-citation"><span class="scite-citation-text"><a rel="nofollow" class="external text" name="scite-3" href="https://msitpros.com/?p=3960" target="_blank">Moe, O. (2017, August 15). Research on CMSTP.exe. Retrieved April 11, 2018.</a></span></span></li><li><span id="scite-4" class="scite-citation"><span class="scite-citation-text"><a rel="nofollow" class="external text" name="scite-4" href="https://twitter.com/NickTyrer/status/958450014111633408" target="_blank">Tyrer, N. (2018, January 30). CMSTP.exe - remote .sct execution applocker bypass. Retrieved April 11, 2018.</a></span></span></li></ol> </div><div class="col"><ol start="5.0"><li><span id="scite-5" class="scite-citation"><span class="scite-citation-text"><a rel="nofollow" class="external text" name="scite-5" href="https://github.com/api0cradle/UltimateAppLockerByPassList" target="_blank">Moe, O. (2018, March 1). Ultimate AppLocker Bypass List. Retrieved April 10, 2018.</a></span></span></li><li><span id="scite-6" class="scite-citation"><span class="scite-citation-text"><a rel="nofollow" class="external text" name="scite-6" href="http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/" target="_blank">Seetharaman, N. (2018, July 7). Detecting CMSTP-Enabled Code Execution and UAC Bypass With Sysmon.. Retrieved August 6, 2018.</a></span></span></li><li><span id="scite-7" class="scite-citation"><span class="scite-citation-text"><a rel="nofollow" class="external text" name="scite-7" href="https://blog.talosintelligence.com/2018/07/multiple-cobalt-personality-disorder.html" target="_blank">Svajcer, V. (2018, July 31). Multiple Cobalt Personality Disorder. Retrieved September 5, 2018.</a></span></span></li><li><span id="scite-8" class="scite-citation"><span class="scite-citation-text"><a rel="nofollow" class="external text" name="scite-8" href="https://www.fireeye.com/blog/threat-research/2018/03/iranian-threat-group-updates-ttps-in-spear-phishing-campaign.html" target="_blank">Singh, S. et al.. (2018, March 13). Iranian Threat Group Updates Tactics, Techniques and Procedures in Spear Phishing Campaign. Retrieved April 11, 2018.</a></span></span></li></ol> </div>
